webpackJsonp([4],{"5K0S":function(t,s){},"9xrS":function(t,s,a){"use strict";var e=a("mccn"),o={render:function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",[t.isLogin?a("div",[a("div",{staticClass:"status-page"},[a("table",{attrs:{cellpadding:"0",cellspacing:"0",border:"0",width:"100%"}},[a("tbody",[a("tr",[a("td",{attrs:{width:"48",valign:"top"}},[a("a",{attrs:{href:"javascript:void(0);"}},[a("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.avastar,expression:"avastar"}],staticClass:"avatar",staticStyle:{"max-width":"48px","max-height":"48px"},attrs:{border:"0",align:"default"}})])]),t._v(" "),a("td",{attrs:{width:"10",valign:"top"}}),t._v(" "),a("td",{attrs:{width:"auto",align:"left"}},[a("span",{staticClass:"bigger"},[a("a",{attrs:{href:""}},[t._v(t._s(t.username))])])]),t._v(" "),a("td",{directives:[{name:"show",rawName:"v-show",value:!t.confirmed,expression:"!confirmed"}],staticStyle:{color:"#e02614"},attrs:{width:"auto"}},[t._v("未激活")])])])]),t._v(" "),a("div",{staticClass:"s-btn",on:{click:function(s){t.mdShowPost=!0}}},[t._v("发帖")]),t._v(" "),a("div",{staticClass:"s-btn"},[t._v("查看资料")]),t._v(" "),a("div",{staticClass:"s-btn"},[t._v("我的帖子")]),t._v(" "),a("div",{staticClass:"s-btn",on:{click:function(s){t.logout()}}},[t._v("登出")])])]):a("div",[a("div",{staticClass:"status-page"},[a("p",{staticClass:"tips"},[t._v("当前尚未登录")]),t._v(" "),a("a",{staticClass:"s-btn",attrs:{href:"javascript:void(0);"},on:{click:function(s){t.mdShowLogin=!0,t.error=""}}},[t._v("登录")]),t._v(" "),a("a",{staticClass:"s-btn",attrs:{href:"javascript:void(0);"},on:{click:function(s){t.mdShowRegister=!0}}},[t._v("注册")])])]),t._v(" "),a("modal",{attrs:{mdShow:t.mdShowLogin},on:{close:t.closeModal}},[a("div",{staticClass:"input-modal",attrs:{slot:"message"},slot:"message"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.error,expression:"error"}],staticClass:"error-tips"},[t._v(t._s(t.error))]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.email,expression:"email"}],attrs:{type:"email",placeholder:"邮箱"},domProps:{value:t.email},on:{input:function(s){s.target.composing||(t.email=s.target.value)}}}),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",placeholder:"密码"},domProps:{value:t.password},on:{input:function(s){s.target.composing||(t.password=s.target.value)}}}),t._v(" "),a("button",{staticClass:"s-btn",on:{click:function(s){t.login()}}},[t._v("确认登录")]),t._v(" "),a("button",{staticClass:"s-btn",on:{click:function(s){t.forget()}}},[t._v("忘记密码")])])]),t._v(" "),a("modal",{attrs:{mdShow:t.mdShowRegister},on:{close:t.closeModal}},[a("div",{staticClass:"input-modal",attrs:{slot:"message"},slot:"message"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.error,expression:"error"}],staticClass:"error-tips"},[t._v(t._s(t.error))]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.email,expression:"email"}],attrs:{type:"email",placeholder:"邮箱"},domProps:{value:t.email},on:{input:function(s){s.target.composing||(t.email=s.target.value)}}}),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],attrs:{type:"text",placeholder:"用户名"},domProps:{value:t.username},on:{input:function(s){s.target.composing||(t.username=s.target.value)}}}),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",placeholder:"密码"},domProps:{value:t.password},on:{input:function(s){s.target.composing||(t.password=s.target.value)}}}),t._v(" "),a("button",{staticClass:"s-btn",on:{click:function(s){t.register()}}},[t._v("确认注册")])])]),t._v(" "),a("modal",{attrs:{mdShow:t.mdShowPost},on:{close:t.closeModal}},[a("div",{staticClass:"input-modal",attrs:{slot:"message"},slot:"message"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.error,expression:"error"}],staticClass:"error-tips"},[t._v(t._s(t.error))]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.post_title,expression:"post_title"}],attrs:{type:"text",placeholder:"标题"},domProps:{value:t.post_title},on:{input:function(s){s.target.composing||(t.post_title=s.target.value)}}}),t._v(" "),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.post_body,expression:"post_body"}],attrs:{placeholder:"内容"},domProps:{value:t.post_body},on:{input:function(s){s.target.composing||(t.post_body=s.target.value)}}}),t._v(" "),a("select",{directives:[{name:"model",rawName:"v-model",value:t.post_city,expression:"post_city"}],on:{change:function(s){var a=Array.prototype.filter.call(s.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.post_city=s.target.multiple?a:a[0]}}},[a("option",{attrs:{disabled:"",value:""}},[t._v("请选择城市:")]),t._v(" "),a("option",[t._v("深圳")]),t._v(" "),a("option",[t._v("广州")]),t._v(" "),a("option",[t._v("上海")]),t._v(" "),a("option",[t._v("杭州")]),t._v(" "),a("option",[t._v("南京")])]),t._v(" "),a("button",{staticClass:"s-btn",on:{click:function(s){t.topost()}}},[t._v("确认提交")])])])],1)},staticRenderFns:[]};var i=function(t){a("5K0S")},n=a("Z0/y")(e.a,o,!1,i,null,null);s.a=n.exports},g8gV:function(t,s){},mccn:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_axios__=__webpack_require__("aozt"),__WEBPACK_IMPORTED_MODULE_0_axios___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_axios__),__WEBPACK_IMPORTED_MODULE_1__components_Modal__=__webpack_require__("/o5o");__webpack_exports__.a={name:"user-status",data:function(){return{isLogin:!1,email:"",username:"",password:"",avastar:"",confirmed:!0,error:"",post_title:"",post_body:"",post_city:"",baseUrl:"https://www.vetoer.club/api/v1",mdShowLogin:!1,mdShowRegister:!1,mdShowPost:!1}},components:{Modal:__WEBPACK_IMPORTED_MODULE_1__components_Modal__.a},mounted:function(){this.checkUserStatus()},methods:{checkUserStatus:function checkUserStatus(){var token=sessionStorage.getItem("token");null==token?this.isLogin=!1:(this.isLogin=!0,this.avastar=sessionStorage.getItem("avastar"),this.username=sessionStorage.getItem("username"),this.confirmed=eval(sessionStorage.getItem("confirmed")))},login:function(){var t=this;this.mdShowLogin=!0;var s=this.baseUrl+"/tokens/";__WEBPACK_IMPORTED_MODULE_0_axios___default()({method:"POST",url:s,auth:{username:this.email,password:this.password}}).then(function(s){for(var a in console.log(s),s.data)sessionStorage.setItem(a,s.data[a]);t.avastar=s.data.avastar,t.username=s.data.username,t.confirmed=s.data.confirmed,t.isLogin=!0,t.mdShowLogin=!1,t.error=""}).catch(function(s){t.error="用户名或密码错误!"})},register:function(){var t=this;this.mdShowRegister=!0;var s=this.baseUrl+"/users/register";__WEBPACK_IMPORTED_MODULE_0_axios___default()({method:"POST",url:s,data:{email:this.email,username:this.username,password:this.password}}).then(function(s){console.log(s),201==s.status&&(t.mdShowRegister=!1,t.mdShowLogin=!0,t.password="",t.error="注册成功,请前往邮箱激活!")}).catch(function(s){t.error="注册失败,可能邮箱或用户名重复!"})},logout:function(){confirm("确认要登出吗?")&&(sessionStorage.clear(),this.isLogin=!1)},forget:function(){var t=this.baseUrl+"/users/";__WEBPACK_IMPORTED_MODULE_0_axios___default.a.get(t).then(function(t){console.log(t)}).catch(function(t){})},topost:function(){var t=this,s={"深圳":"sz","广州":"gz","上海":"sh","杭州":"hz","南京":"nj"};void 0!=s[this.post_city]?__WEBPACK_IMPORTED_MODULE_0_axios___default()({method:"POST",url:this.baseUrl+"/"+s[this.post_city]+"/posts",data:{title:this.post_title,body:this.post_body}}).then(function(a){t.$emit("tomypost",s[t.post_city]),t.mdShowPost=!1}).catch(function(s){t.error="发帖错误,请检查是否激活账号..."}):this.error="请选择城市"},closeModal:function(){this.mdShowLogin=!1,this.mdShowRegister=!1,this.mdShowPost=!1,this.error=""}}}},vPk4:function(t,s,a){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var e=a("HkA2"),o=a("Ck0u"),i=a("9xrS"),n=a("aozt"),r=a.n(n),l={name:"post-detail",data:function(){return{baseUrl:"https://www.vetoer.club",author:{},post:{},title:"",comments:{},comment:"",pagenum:20,prev:"",next:"",commentCount:0}},props:{postId:{type:String,default:""}},watch:{postId:function(){this.getPostDetail()}},mounted:function(){this.getPostDetail()},methods:{getPostDetail:function(){var t=this;if(null!=this.postId||""!=this.postId){var s=this.baseUrl+"/api/v1/posts/"+this.postId;r.a.get(s).then(function(s){console.log("get post detail : "),console.log(s.data),t.author.username=s.data.author_name,t.author.url=s.data.author_url,t.author.avastar=s.data.author_avastar,t.title=s.data.title,t.post.body=s.data.body,t.post.timestamp=s.data.timestamp,t.getComments(s.data.comments_url)}).catch(function(t){})}},getComments:function(t){var s=this,a=this.baseUrl+t;r.a.get(a).then(function(t){console.log("get comments: "),console.log(t),s.comments=t.data.comments,s.prev=t.data.prev,s.next=t.data.next,s.commentCount=t.data.count}).catch(function(t){})},postComment:function(){var t=this;if(""!=this.comment){var s=this.baseUrl+"/api/v1/posts/"+this.postId+"/comments/";r()({method:"POST",url:s,data:{body:this.comment}}).then(function(s){alert("评论成功!"),t.getPostDetail(),t.comment=""}).catch(function(t){alert("评论失败,确认是否激活账号或是否登录!")})}else alert("评论内容不能为空!")},formatTime:function(t){return new Date(t).toLocaleString()}}},c={render:function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"detail-content"},[a("div",{staticClass:"detail-bread"},[a("ul",[a("li",[a("router-link",{attrs:{to:"/"}},[t._v("首页")])],1),t._v(" "),a("li",[t._v(" >")]),t._v(" "),a("li",[a("router-link",{attrs:{to:"/post"}},[t._v("论坛")])],1)])]),t._v(" "),a("div",{staticClass:"article box"},[a("div",{staticClass:"avastar"},[a("img",{attrs:{src:t.author.avastar,alt:""}})]),t._v(" "),a("div",{staticClass:"title"},[a("h1",[t._v(t._s(t.title))])]),t._v(" "),a("div",{staticClass:"article-detail"},[a("div",{staticClass:"author"},[t._v("发帖人: "),a("a",{attrs:{href:"javascript:void(0);"}},[a("span",[t._v(t._s(t.author.username))])])]),t._v(" "),a("div",{staticClass:"timestamp"},[t._v("时间: "),a("span",[t._v(t._s(t.formatTime(t.post.timestamp)))])])]),t._v(" "),a("div",{staticClass:"body"},[a("p",[t._v(t._s(t.post.body))])])]),t._v(" "),a("div",{staticClass:"comment-input box"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.comment,expression:"comment"}],attrs:{placeholder:"请表达一下看法"},domProps:{value:t.comment},on:{input:function(s){s.target.composing||(t.comment=s.target.value)}}}),t._v(" "),a("button",{staticClass:"s-btn",on:{click:function(s){t.postComment()}}},[t._v("提交")])]),t._v(" "),a("div",{staticClass:"comment-list box"},[a("ul",t._l(t.comments,function(s){return a("li",{staticClass:"cell"},[a("div",{staticClass:"comment-img"},[a("img",{attrs:{src:s.author_avastar,alt:""}})]),t._v(" "),a("div",{staticClass:"comment-body"},[a("p",[t._v(t._s(s.body))])]),t._v(" "),a("div",{staticClass:"article-detail"},[a("div",{staticClass:"author"},[t._v("回复人: "),a("a",{attrs:{href:"javascript:void(0);"}},[a("span",[t._v(t._s(s.author_name))])])]),t._v(" "),a("div",{staticClass:"timestamp"},[t._v("时间: "),a("span",[t._v(t._s(t.formatTime(s.timestamp)))])])])])})),t._v(" "),a("section",{directives:[{name:"show",rawName:"v-show",value:t.commentCount>t.pagenum,expression:"commentCount>pagenum"}],staticClass:"pages-wrap"},[a("ul",{staticClass:"pagination clearfix"},[a("li",{class:{disabled:t.commentCount<t.pagenum||null==t.prev}},[a("a",{attrs:{href:"javascript:;"},on:{click:function(s){t.getComments(t.prev)}}},[t._v(" 上一页 ")])]),t._v(" "),a("li",{class:{disabled:t.commentCount<t.pagenum||null==t.next}},[a("a",{attrs:{href:"javascript:;"},on:{click:function(s){t.getComments(t.next)}}},[t._v(" 下一页 ")])])])])])])},staticRenderFns:[]};var v=a("Z0/y")(l,c,!1,function(t){a("zrGZ")},"data-v-5a03b5bd",null).exports,m={name:"post-detail-page",data:function(){return{baseurl:"https://www.vetoer.club/api/v1",city:"sz"}},components:{NavHeader:e.a,NavFooter:o.a,UserStatus:i.a,PostDetail:v},mounted:function(){},methods:{cityChange:function(t){this.city=t,console.log("city change : "+t)}}},d={render:function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",[a("nav-header",{attrs:{emitCity:t.city},on:{change:t.cityChange}}),t._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"leftBar"}),t._v(" "),a("div",{staticClass:"rightBar"},[a("div",{staticClass:"box"},[a("div",{staticClass:"cell"},[a("user-status",{on:{tomypost:t.cityChange}})],1),t._v(" "),a("div",{staticClass:"cell"})])]),t._v(" "),a("div",{staticClass:"main box"},[a("div",{staticClass:"posts"},[a("post-detail",{attrs:{postId:t.$route.params.postId}})],1)])]),t._v(" "),a("nav-footer")],1)},staticRenderFns:[]};var _=a("Z0/y")(m,d,!1,function(t){a("g8gV")},"data-v-5f6487fa",null);s.default=_.exports},zrGZ:function(t,s){}});
//# sourceMappingURL=4.69d21120005f28aaa192.js.map