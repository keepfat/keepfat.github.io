webpackJsonp([3],{"0cK0":function(t,e){},"2OYO":function(t,e){},"9xrS":function(t,e,s){"use strict";var a=s("mccn"),o={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.isLogin?s("div",[s("div",{staticClass:"status-page"},[s("table",{attrs:{cellpadding:"0",cellspacing:"0",border:"0",width:"100%"}},[s("tbody",[s("tr",[s("td",{attrs:{width:"48",valign:"top"}},[s("a",{attrs:{href:"javascript:void(0);"}},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.avastar,expression:"avastar"}],staticClass:"avatar",staticStyle:{"max-width":"48px","max-height":"48px"},attrs:{border:"0",align:"default"}})])]),t._v(" "),s("td",{attrs:{width:"10",valign:"top"}}),t._v(" "),s("td",{attrs:{width:"auto",align:"left"}},[s("span",{staticClass:"bigger"},[s("a",{attrs:{href:""}},[t._v(t._s(t.username))])])]),t._v(" "),s("td",{directives:[{name:"show",rawName:"v-show",value:!t.confirmed,expression:"!confirmed"}],staticStyle:{color:"#e02614"},attrs:{width:"auto"}},[t._v("未激活")])])])]),t._v(" "),s("div",{staticClass:"s-btn",on:{click:function(e){t.mdShowPost=!0}}},[t._v("发帖")]),t._v(" "),s("div",{staticClass:"s-btn"},[t._v("查看资料")]),t._v(" "),s("div",{staticClass:"s-btn"},[t._v("我的帖子")]),t._v(" "),s("div",{staticClass:"s-btn",on:{click:function(e){t.logout()}}},[t._v("登出")])])]):s("div",[s("div",{staticClass:"status-page"},[s("p",{staticClass:"tips"},[t._v("当前尚未登录")]),t._v(" "),s("a",{staticClass:"s-btn",attrs:{href:"javascript:void(0);"},on:{click:function(e){t.mdShowLogin=!0,t.error=""}}},[t._v("登录")]),t._v(" "),s("a",{staticClass:"s-btn",attrs:{href:"javascript:void(0);"},on:{click:function(e){t.mdShowRegister=!0}}},[t._v("注册")])])]),t._v(" "),t._m(0),t._v(" "),s("modal",{attrs:{mdShow:t.mdShowLogin},on:{close:t.closeModal}},[s("div",{staticClass:"input-modal",attrs:{slot:"message"},slot:"message"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.error,expression:"error"}],staticClass:"error-tips"},[t._v(t._s(t.error))]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.email,expression:"email"}],attrs:{type:"email",placeholder:"邮箱"},domProps:{value:t.email},on:{input:function(e){e.target.composing||(t.email=e.target.value)}}}),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",placeholder:"密码"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),t._v(" "),s("button",{staticClass:"s-btn",on:{click:function(e){t.login()}}},[t._v("确认登录")]),t._v(" "),s("button",{staticClass:"s-btn",on:{click:function(e){t.forget()}}},[t._v("忘记密码")])])]),t._v(" "),s("modal",{attrs:{mdShow:t.mdShowRegister},on:{close:t.closeModal}},[s("div",{staticClass:"input-modal",attrs:{slot:"message"},slot:"message"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.error,expression:"error"}],staticClass:"error-tips"},[t._v(t._s(t.error))]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.email,expression:"email"}],attrs:{type:"email",placeholder:"邮箱"},domProps:{value:t.email},on:{input:function(e){e.target.composing||(t.email=e.target.value)}}}),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],attrs:{type:"text",placeholder:"用户名"},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}}),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",placeholder:"密码"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),t._v(" "),s("button",{staticClass:"s-btn",on:{click:function(e){t.register()}}},[t._v("确认注册")])])]),t._v(" "),s("modal",{attrs:{mdShow:t.mdShowPost},on:{close:t.closeModal}},[s("div",{staticClass:"input-modal",attrs:{slot:"message"},slot:"message"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.error,expression:"error"}],staticClass:"error-tips"},[t._v(t._s(t.error))]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.post_title,expression:"post_title"}],attrs:{type:"text",placeholder:"标题"},domProps:{value:t.post_title},on:{input:function(e){e.target.composing||(t.post_title=e.target.value)}}}),t._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.post_body,expression:"post_body"}],attrs:{placeholder:"内容"},domProps:{value:t.post_body},on:{input:function(e){e.target.composing||(t.post_body=e.target.value)}}}),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.post_city,expression:"post_city"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.post_city=e.target.multiple?s:s[0]}}},[s("option",{attrs:{disabled:"",value:""}},[t._v("请选择城市:")]),t._v(" "),s("option",[t._v("深圳")]),t._v(" "),s("option",[t._v("广州")]),t._v(" "),s("option",[t._v("上海")]),t._v(" "),s("option",[t._v("杭州")]),t._v(" "),s("option",[t._v("南京")])]),t._v(" "),s("button",{staticClass:"s-btn",on:{click:function(e){t.topost()}}},[t._v("确认提交")])])])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"show-code"},[e("div",[this._v("文明发言，礼貌回帖")])])}]};var i=function(t){s("0cK0")},n=s("Z0/y")(a.a,o,!1,i,null,null);e.a=n.exports},"e/4O":function(t,e){},g4V9:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_axios__=__webpack_require__("aozt"),__WEBPACK_IMPORTED_MODULE_0_axios___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_axios__);__webpack_exports__.a={name:"post-detail",data:function(){return{baseUrl:this.GLOBAL.host,author:{},post:{},comments_url:"",title:"",comments:{},comment:"",admin:!1,pagenum:20,prev:"",next:"",commentCount:0}},props:{postId:{type:String,default:""}},watch:{postId:function(){this.getPostDetail()}},mounted:function mounted(){this.getPostDetail(),this.admin=eval(sessionStorage.getItem("admin"))},methods:{getPostDetail:function(){var t=this;if(null!=this.postId||""!=this.postId){var e=this.baseUrl+"/api/v1/posts/"+this.postId;__WEBPACK_IMPORTED_MODULE_0_axios___default.a.get(e).then(function(e){t.author.username=e.data.author_name,t.author.url=e.data.author_url,t.author.avastar=e.data.author_avastar,t.title=e.data.title,t.post.body=e.data.body,t.post.timestamp=e.data.timestamp,t.comments_url=e.data.comments_url,t.getComments()}).catch(function(t){})}},getComments:function(){var t=this;if(""!=this.comments_url){var e=this.baseUrl+this.comments_url;__WEBPACK_IMPORTED_MODULE_0_axios___default.a.get(e).then(function(e){console.log("get comments: "),console.log(e),t.comments=e.data.comments,t.prev=e.data.prev,t.next=e.data.next,t.commentCount=e.data.count}).catch(function(t){})}},postComment:function(){var t=this;if(""!=this.comment){var e=this.baseUrl+"/api/v1/posts/"+this.postId+"/comments/";__WEBPACK_IMPORTED_MODULE_0_axios___default()({method:"POST",url:e,data:{body:this.comment}}).then(function(e){alert("评论成功!"),t.getPostDetail(),t.comment=""}).catch(function(t){alert("评论失败,确认是否激活账号或是否登录!")})}else alert("评论内容不能为空!")},deletePost:function(){var t=this;if(confirm("确认是否block这个帖子?")){var e=this.baseUrl+"/api/v1/posts/delete/"+this.postId;__WEBPACK_IMPORTED_MODULE_0_axios___default()({method:"DELETE",url:e}).then(function(e){console.log(e),t.$router.push({path:"/post"})}).catch(function(t){alert("删除帖子时出现错误,确认当前登录用户是否是管理员!")})}},deleteComment:function(t){var e=this;if(confirm("确认是否block这条评论?")){var s=this.baseUrl+"/api/v1/comments/"+t;__WEBPACK_IMPORTED_MODULE_0_axios___default()({method:"DELETE",url:s}).then(function(t){e.getComments()}).catch(function(t){alert("删除评论出现错误,确认当前登录用户是否是管理员!")})}},formatTime:function(t){return new Date(t).toLocaleString()}}}},mccn:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_axios__=__webpack_require__("aozt"),__WEBPACK_IMPORTED_MODULE_0_axios___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_axios__),__WEBPACK_IMPORTED_MODULE_1__components_Modal__=__webpack_require__("/o5o");__webpack_exports__.a={name:"user-status",data:function(){return{isLogin:!1,email:"",username:"",password:"",avastar:"",confirmed:!0,admin:!1,error:"",post_title:"",post_body:"",post_city:"",baseUrl:this.GLOBAL.host,mdShowLogin:!1,mdShowRegister:!1,mdShowPost:!1}},components:{Modal:__WEBPACK_IMPORTED_MODULE_1__components_Modal__.a},mounted:function(){this.checkUserStatus()},methods:{checkUserStatus:function checkUserStatus(){var token=sessionStorage.getItem("token");null==token?this.isLogin=!1:(this.isLogin=!0,this.avastar=sessionStorage.getItem("avastar"),this.username=sessionStorage.getItem("username"),this.confirmed=eval(sessionStorage.getItem("confirmed")),this.admin=eval(sessionStorage.getItem("admin")))},login:function(){var t=this;this.mdShowLogin=!0,this.error="";var e=this.baseUrl+"/api/v1/tokens/";__WEBPACK_IMPORTED_MODULE_0_axios___default()({method:"POST",url:e,auth:{username:this.email,password:this.password}}).then(function(e){for(var s in console.log(e),e.data)sessionStorage.setItem(s,e.data[s]);t.avastar=e.data.avastar,t.username=e.data.username,t.confirmed=e.data.confirmed,t.isLogin=!0,t.mdShowLogin=!1,t.error=""}).catch(function(e){t.error="用户名或密码错误!"})},register:function(){var t=this;this.mdShowRegister=!0;var e=this.baseUrl+"/api/v1/users/register";__WEBPACK_IMPORTED_MODULE_0_axios___default()({method:"POST",url:e,data:{email:this.email,username:this.username,password:this.password}}).then(function(e){console.log(e),201==e.status&&(t.mdShowRegister=!1,t.mdShowLogin=!0,t.password="",t.error="注册成功,请前往邮箱激活!")}).catch(function(e){t.error="注册失败,可能邮箱或用户名重复!"})},logout:function(){confirm("确认要登出吗?")&&(sessionStorage.clear(),this.isLogin=!1)},forget:function(){var t=this.baseUrl+"/api/v1/users/";__WEBPACK_IMPORTED_MODULE_0_axios___default.a.get(t).then(function(t){console.log(t)}).catch(function(t){})},topost:function(){var t=this;this.error="";var e={"深圳":"sz","广州":"gz","上海":"sh","杭州":"hz","南京":"nj"};void 0!=e[this.post_city]?__WEBPACK_IMPORTED_MODULE_0_axios___default()({method:"POST",url:this.baseUrl+"/api/v1/"+e[this.post_city]+"/posts",data:{title:this.post_title,body:this.post_body}}).then(function(s){t.$emit("tomypost",e[t.post_city]),t.mdShowPost=!1}).catch(function(e){t.error="发帖错误,请检查是否激活账号..."}):this.error="请选择城市"},closeModal:function(){this.mdShowLogin=!1,this.mdShowRegister=!1,this.mdShowPost=!1,this.error=""}}}},vPk4:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("HkA2"),o=s("Ck0u"),i=s("9xrS"),n=s("g4V9"),r={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"detail-content"},[s("div",{staticClass:"detail-bread"},[s("ul",[s("li",[s("router-link",{attrs:{to:"/"}},[t._v("首页")])],1),t._v(" "),s("li",[t._v(" >")]),t._v(" "),s("li",[s("router-link",{attrs:{to:"/post"}},[t._v("论坛")])],1)])]),t._v(" "),s("div",{staticClass:"article box"},[s("div",{staticClass:"avastar"},[s("img",{attrs:{src:t.author.avastar,alt:""}})]),t._v(" "),s("div",{staticClass:"title"},[s("h1",[t._v(t._s(t.title))])]),t._v(" "),s("div",{staticClass:"article-detail"},[s("div",{staticClass:"author"},[t._v("发帖人: "),s("a",{attrs:{href:"javascript:void(0);"}},[s("span",[t._v(t._s(t.author.username))])])]),t._v(" "),s("div",{staticClass:"timestamp"},[t._v("时间: "),s("span",[t._v(t._s(t.formatTime(t.post.timestamp)))])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.admin,expression:"admin"}],staticClass:"block",on:{click:function(e){t.deletePost()}}},[t._v("block")])]),t._v(" "),s("div",{staticClass:"body"},[s("p",[t._v(t._s(t.post.body))])])]),t._v(" "),s("div",{staticClass:"comment-list box"},[s("ul",t._l(t.comments,function(e){return s("li",{staticClass:"cell"},[s("div",{staticClass:"comment-img"},[s("img",{attrs:{src:e.author_avastar,alt:""}})]),t._v(" "),s("div",{staticClass:"comment-body"},[s("p",[t._v(t._s(e.body))])]),t._v(" "),s("div",{staticClass:"article-detail"},[s("div",{staticClass:"author"},[t._v("回复人: "),s("a",{attrs:{href:"javascript:void(0);"}},[s("span",[t._v(t._s(e.author_name))])])]),t._v(" "),s("div",{staticClass:"timestamp"},[t._v("时间: "),s("span",[t._v(t._s(t.formatTime(e.timestamp)))])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.admin,expression:"admin"}],staticClass:"block",on:{click:function(s){t.deleteComment(e.id)}}},[t._v("block")])])])})),t._v(" "),s("section",{directives:[{name:"show",rawName:"v-show",value:t.commentCount>t.pagenum,expression:"commentCount>pagenum"}],staticClass:"pages-wrap"},[s("ul",{staticClass:"pagination clearfix"},[s("li",{class:{disabled:t.commentCount<t.pagenum||null==t.prev}},[s("a",{attrs:{href:"javascript:;"},on:{click:function(e){t.getComments(t.prev)}}},[t._v(" 上一页 ")])]),t._v(" "),s("li",{class:{disabled:t.commentCount<t.pagenum||null==t.next}},[s("a",{attrs:{href:"javascript:;"},on:{click:function(e){t.getComments(t.next)}}},[t._v(" 下一页 ")])])])])]),t._v(" "),s("div",{staticClass:"comment-input box"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.comment,expression:"comment"}],attrs:{placeholder:"请表达一下看法"},domProps:{value:t.comment},on:{input:function(e){e.target.composing||(t.comment=e.target.value)}}}),t._v(" "),s("button",{staticClass:"s-btn",on:{click:function(e){t.postComment()}}},[t._v("提交")])])])},staticRenderFns:[]};var c=function(t){s("e/4O")},l=s("Z0/y")(n.a,r,!1,c,"data-v-739ddcc0",null).exports,_={name:"post-detail-page",data:function(){return{city:"sz"}},components:{NavHeader:a.a,NavFooter:o.a,UserStatus:i.a,PostDetail:l},mounted:function(){},methods:{cityChange:function(t){this.city=t}}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("nav-header",{attrs:{emitCity:t.city},on:{change:t.cityChange}}),t._v(" "),s("div",{staticClass:"content"},[s("div",{staticClass:"leftBar"}),t._v(" "),s("div",{staticClass:"rightBar"},[s("div",{staticClass:"box"},[s("div",{staticClass:"cell"},[s("user-status",{on:{tomypost:t.cityChange}})],1),t._v(" "),s("div",{staticClass:"cell"})])]),t._v(" "),s("div",{staticClass:"main box"},[s("div",{staticClass:"posts"},[s("post-detail",{attrs:{postId:t.$route.params.postId}})],1)])]),t._v(" "),s("nav-footer")],1)},staticRenderFns:[]};var d=s("Z0/y")(_,m,!1,function(t){s("2OYO")},"data-v-5b323749",null);e.default=d.exports}});
//# sourceMappingURL=3.62371d4ce3f715b64ebd.js.map