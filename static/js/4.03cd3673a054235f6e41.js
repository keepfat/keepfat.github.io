webpackJsonp([4],{"0cK0":function(t,s){},"9xrS":function(t,s,e){"use strict";var a=e("mccn"),o={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[t.isLogin?e("div",[e("div",{staticClass:"status-page"},[e("table",{attrs:{cellpadding:"0",cellspacing:"0",border:"0",width:"100%"}},[e("tbody",[e("tr",[e("td",{attrs:{width:"48",valign:"top"}},[e("a",{attrs:{href:"javascript:void(0);"}},[e("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.avastar,expression:"avastar"}],staticClass:"avatar",staticStyle:{"max-width":"48px","max-height":"48px"},attrs:{border:"0",align:"default"}})])]),t._v(" "),e("td",{attrs:{width:"10",valign:"top"}}),t._v(" "),e("td",{attrs:{width:"auto",align:"left"}},[e("span",{staticClass:"bigger"},[e("a",{attrs:{href:""}},[t._v(t._s(t.username))])])]),t._v(" "),e("td",{directives:[{name:"show",rawName:"v-show",value:!t.confirmed,expression:"!confirmed"}],staticStyle:{color:"#e02614"},attrs:{width:"auto"}},[t._v("未激活")])])])]),t._v(" "),e("div",{staticClass:"s-btn",on:{click:function(s){t.mdShowPost=!0}}},[t._v("发帖")]),t._v(" "),e("div",{staticClass:"s-btn"},[t._v("查看资料")]),t._v(" "),e("div",{staticClass:"s-btn"},[t._v("我的帖子")]),t._v(" "),e("div",{staticClass:"s-btn",on:{click:function(s){t.logout()}}},[t._v("登出")])])]):e("div",[e("div",{staticClass:"status-page"},[e("p",{staticClass:"tips"},[t._v("当前尚未登录")]),t._v(" "),e("a",{staticClass:"s-btn",attrs:{href:"javascript:void(0);"},on:{click:function(s){t.mdShowLogin=!0,t.error=""}}},[t._v("登录")]),t._v(" "),e("a",{staticClass:"s-btn",attrs:{href:"javascript:void(0);"},on:{click:function(s){t.mdShowRegister=!0}}},[t._v("注册")])])]),t._v(" "),t._m(0),t._v(" "),e("modal",{attrs:{mdShow:t.mdShowLogin},on:{close:t.closeModal}},[e("div",{staticClass:"input-modal",attrs:{slot:"message"},slot:"message"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.error,expression:"error"}],staticClass:"error-tips"},[t._v(t._s(t.error))]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.email,expression:"email"}],attrs:{type:"email",placeholder:"邮箱"},domProps:{value:t.email},on:{input:function(s){s.target.composing||(t.email=s.target.value)}}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",placeholder:"密码"},domProps:{value:t.password},on:{input:function(s){s.target.composing||(t.password=s.target.value)}}}),t._v(" "),e("button",{staticClass:"s-btn",on:{click:function(s){t.login()}}},[t._v("确认登录")]),t._v(" "),e("button",{staticClass:"s-btn",on:{click:function(s){t.forget()}}},[t._v("忘记密码")])])]),t._v(" "),e("modal",{attrs:{mdShow:t.mdShowRegister},on:{close:t.closeModal}},[e("div",{staticClass:"input-modal",attrs:{slot:"message"},slot:"message"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.error,expression:"error"}],staticClass:"error-tips"},[t._v(t._s(t.error))]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.email,expression:"email"}],attrs:{type:"email",placeholder:"邮箱"},domProps:{value:t.email},on:{input:function(s){s.target.composing||(t.email=s.target.value)}}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],attrs:{type:"text",placeholder:"用户名"},domProps:{value:t.username},on:{input:function(s){s.target.composing||(t.username=s.target.value)}}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",placeholder:"密码"},domProps:{value:t.password},on:{input:function(s){s.target.composing||(t.password=s.target.value)}}}),t._v(" "),e("button",{staticClass:"s-btn",on:{click:function(s){t.register()}}},[t._v("确认注册")])])]),t._v(" "),e("modal",{attrs:{mdShow:t.mdShowPost},on:{close:t.closeModal}},[e("div",{staticClass:"input-modal",attrs:{slot:"message"},slot:"message"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.error,expression:"error"}],staticClass:"error-tips"},[t._v(t._s(t.error))]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.post_title,expression:"post_title"}],attrs:{type:"text",placeholder:"标题"},domProps:{value:t.post_title},on:{input:function(s){s.target.composing||(t.post_title=s.target.value)}}}),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.post_body,expression:"post_body"}],attrs:{placeholder:"内容"},domProps:{value:t.post_body},on:{input:function(s){s.target.composing||(t.post_body=s.target.value)}}}),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.post_city,expression:"post_city"}],on:{change:function(s){var e=Array.prototype.filter.call(s.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.post_city=s.target.multiple?e:e[0]}}},[e("option",{attrs:{disabled:"",value:""}},[t._v("请选择城市:")]),t._v(" "),e("option",[t._v("深圳")]),t._v(" "),e("option",[t._v("广州")]),t._v(" "),e("option",[t._v("上海")]),t._v(" "),e("option",[t._v("杭州")]),t._v(" "),e("option",[t._v("南京")])]),t._v(" "),e("button",{staticClass:"s-btn",on:{click:function(s){t.topost()}}},[t._v("确认提交")])])])],1)},staticRenderFns:[function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"show-code"},[s("div",[this._v("文明发言，礼貌回帖")])])}]};var i=function(t){e("0cK0")},r=e("Z0/y")(a.a,o,!1,i,null,null);s.a=r.exports},Aqze:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=e("HkA2"),o=e("Ck0u"),i=e("9xrS"),r=e("aozt"),n=e.n(r),c={name:"post-list",data:function(){return{baseUrl:this.GLOBAL.host,pagenum:20,prev:null,next:null,count:0,posts:[]}},props:{city:{type:String,default:"sz"}},mounted:function(){this.getPosts(this.baseUrl+"/api/v1/"+this.city+"/posts/")},watch:{city:function(){console.log("city change: "+this.city),this.getPosts(this.baseUrl+"/api/v1/"+this.city+"/posts/")}},methods:{getPosts:function(t){var s=this;n.a.get(t).then(function(t){console.log(t.data),s.prev=t.data.prev,s.next=t.data.next,s.posts=t.data.posts,s.count=t.data.count}).catch(function(t){}),window.scrollTo({behavior:"smooth",top:10})},clickTitle:function(t){this.$emit("toPostDetail",t)},formatTime:function(t){return new Date(t).toLocaleString()}}},l={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("ul",{staticClass:"list"},t._l(t.posts,function(s){return e("li",[e("div",{staticClass:"avastar"},[e("img",{attrs:{src:s.author_avastar,alt:"avastar"}})]),t._v(" "),e("div",{staticClass:"title"},[e("router-link",{attrs:{to:"/post/"+s.id}},[t._v(t._s(s.title))])],1),t._v(" "),e("div",{staticClass:"topic_info"},[e("div",{staticClass:"author"},[t._v("发帖人: "),e("strong",[e("a",{attrs:{href:"javascript:void(0);"}},[t._v(t._s(s.author_name))])])]),t._v(" "),e("div",{staticClass:"timestamp"},[t._v("时间: "),e("span",[t._v(t._s(t.formatTime(s.timestamp)))])])]),t._v(" "),e("div",{staticClass:"reply_count"},[t._v(t._s(s.comment_count))])])})),t._v(" "),e("section",{directives:[{name:"show",rawName:"v-show",value:t.count>t.pagenum,expression:"count>pagenum"}],staticClass:"pages-wrap"},[e("ul",{staticClass:"pagination clearfix"},[e("li",{class:{disabled:null==t.prev}},[e("a",{attrs:{href:"javascript:;"},on:{click:function(s){t.getPosts(t.baseUrl+"/api/v1/posts/")}}},[t._v(" 首页 ")])]),t._v(" "),e("li",{class:{disabled:t.count<t.pagenum||null==t.prev}},[e("a",{attrs:{href:"javascript:;"},on:{click:function(s){t.getPosts(t.baseUrl+t.prev)}}},[t._v(" 上一页 ")])]),t._v(" "),e("li",{class:{disabled:t.count<t.pagenum||null==t.next}},[e("a",{attrs:{href:"javascript:;"},on:{click:function(s){t.getPosts(t.baseUrl+t.next)}}},[t._v(" 下一页 ")])])])])])},staticRenderFns:[]};var v=e("Z0/y")(c,l,!1,function(t){e("jgJ5")},"data-v-f3ade3ce",null).exports,_={name:"posts-page",data:function(){return{city:"sz"}},components:{NavHeader:a.a,NavFooter:o.a,UserStatus:i.a,PostList:v},mounted:function(){},methods:{cityChange:function(t){this.city=t},toPostDetail:function(t){console.log(t)}}},d={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("nav-header",{attrs:{emitCity:t.city},on:{change:t.cityChange}}),t._v(" "),e("div",{staticClass:"content"},[e("div",{staticClass:"leftBar"}),t._v(" "),e("div",{staticClass:"rightBar"},[e("div",{staticClass:"box"},[e("div",{staticClass:"cell"},[e("user-status",{on:{tomypost:t.cityChange}})],1),t._v(" "),e("div",{staticClass:"cell"})])]),t._v(" "),e("div",{staticClass:"main box"},[e("div",{staticClass:"posts"},[e("post-list",{attrs:{city:t.city},on:{toPostDetail:t.toPostDetail}})],1)])]),t._v(" "),e("nav-footer")],1)},staticRenderFns:[]};var u=e("Z0/y")(_,d,!1,function(t){e("lfs5")},"data-v-6cfc6262",null);s.default=u.exports},jgJ5:function(t,s){},lfs5:function(t,s){},mccn:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_axios__=__webpack_require__("aozt"),__WEBPACK_IMPORTED_MODULE_0_axios___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_axios__),__WEBPACK_IMPORTED_MODULE_1__components_Modal__=__webpack_require__("/o5o");__webpack_exports__.a={name:"user-status",data:function(){return{isLogin:!1,email:"",username:"",password:"",avastar:"",confirmed:!0,admin:!1,error:"",post_title:"",post_body:"",post_city:"",baseUrl:this.GLOBAL.host,mdShowLogin:!1,mdShowRegister:!1,mdShowPost:!1}},components:{Modal:__WEBPACK_IMPORTED_MODULE_1__components_Modal__.a},mounted:function(){this.checkUserStatus()},methods:{checkUserStatus:function checkUserStatus(){var token=sessionStorage.getItem("token");null==token?this.isLogin=!1:(this.isLogin=!0,this.avastar=sessionStorage.getItem("avastar"),this.username=sessionStorage.getItem("username"),this.confirmed=eval(sessionStorage.getItem("confirmed")),this.admin=eval(sessionStorage.getItem("admin")))},login:function(){var t=this;this.mdShowLogin=!0,this.error="";var s=this.baseUrl+"/api/v1/tokens/";__WEBPACK_IMPORTED_MODULE_0_axios___default()({method:"POST",url:s,auth:{username:this.email,password:this.password}}).then(function(s){for(var e in console.log(s),s.data)sessionStorage.setItem(e,s.data[e]);t.avastar=s.data.avastar,t.username=s.data.username,t.confirmed=s.data.confirmed,t.isLogin=!0,t.mdShowLogin=!1,t.error=""}).catch(function(s){t.error="用户名或密码错误!"})},register:function(){var t=this;this.mdShowRegister=!0;var s=this.baseUrl+"/api/v1/users/register";__WEBPACK_IMPORTED_MODULE_0_axios___default()({method:"POST",url:s,data:{email:this.email,username:this.username,password:this.password}}).then(function(s){console.log(s),201==s.status&&(t.mdShowRegister=!1,t.mdShowLogin=!0,t.password="",t.error="注册成功,请前往邮箱激活!")}).catch(function(s){t.error="注册失败,可能邮箱或用户名重复!"})},logout:function(){confirm("确认要登出吗?")&&(sessionStorage.clear(),this.isLogin=!1)},forget:function(){var t=this.baseUrl+"/api/v1/users/";__WEBPACK_IMPORTED_MODULE_0_axios___default.a.get(t).then(function(t){console.log(t)}).catch(function(t){})},topost:function(){var t=this;this.error="";var s={"深圳":"sz","广州":"gz","上海":"sh","杭州":"hz","南京":"nj"};void 0!=s[this.post_city]?__WEBPACK_IMPORTED_MODULE_0_axios___default()({method:"POST",url:this.baseUrl+"/api/v1/"+s[this.post_city]+"/posts",data:{title:this.post_title,body:this.post_body}}).then(function(e){t.$emit("tomypost",s[t.post_city]),t.mdShowPost=!1}).catch(function(s){t.error="发帖错误,请检查是否激活账号..."}):this.error="请选择城市"},closeModal:function(){this.mdShowLogin=!1,this.mdShowRegister=!1,this.mdShowPost=!1,this.error=""}}}}});
//# sourceMappingURL=4.03cd3673a054235f6e41.js.map